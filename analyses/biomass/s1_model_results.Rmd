---
title: "Appendix S1 - Full model results"
output:
  html_document:
    toc: yes
    df_print: paged
  word_document:
    df_print: kable
    toc: yes
  pdf_document:
    toc: yes
---

```{r setup, include=T, echo = F}
knitr::opts_chunk$set(echo = F)

library(soar)
library(ggplot2)
library(dplyr)
library(multipanelfigure)
library(nlme)
library(emmeans)

theme_set(theme_bw())


# Get data using `portalr`:
#treatl <- get_treatment_means() 
# Alternatively, read data from `data/`:
# treatl <- read.csv(here::here("data", "treatl.csv"), stringsAsFactors = T)

plotl <- get_plot_totals()

plot_types <- list_plot_types() %>% filter(plot_type == "EE")

set.seed(1977)
remove_plot <- sample(plot_types$plot, 1, F)


plotl <- plotl %>%
  filter(plot != remove_plot)

treatl <- plots_to_treatment_means(plotl) 

treatl <- treatl %>%
   mutate(censusdate = as.Date(censusdate),
          oera = ordered(oera),
          oplottype = ordered(oplottype))
 
pb <- get_pb(treatl) 

pb_nozero <- pb %>%
  filter(as.numeric(oera) > 1)
energy_ratio <- get_e_ratio(treatl)
compensation <- get_compensation(treatl)

```


# Compensation & total energy use

## Compensation



```{r, echo =F}
remove_plot

comp_mean_gls <- gls(smgran_comp ~ oera,  correlation = corCAR1(form = ~ period), data = compensation)

comp_mean_gls_emmeans <- emmeans(comp_mean_gls, specs = ~ oera)

comp_mean_pred <-  as.data.frame(comp_mean_gls_emmeans) %>%
  mutate(oera = ordered(oera)) %>%
  right_join(compensation)

```


### Table S1. Coefficients from GLS for compensation

```{r}
compensation_coef <- as.data.frame(summary(comp_mean_gls)$tTable)
compensation_coef
```


### Table S2. Estimates from GLS for compensation 

```{r}

compensation_estimates <- as.data.frame(comp_mean_gls_emmeans)
compensation_estimates

```

### Table S3. Contrasts from GLS for compensation 

```{r}
compensation_contrasts <- as.data.frame(pairs(comp_mean_gls_emmeans))
compensation_contrasts

```

## Total energy use

```{r, echo = F}

totale_mean_gls <- gls(total_e_rat ~  oera,  correlation = corCAR1(form = ~ period), data = energy_ratio)

  
```


### Table S4. Coefficients from GLS on total energy ratio

```{r}

te_coef <- as.data.frame(summary(totale_mean_gls)$tTable)

te_coef

```


### Table S5. Estimates from GLS on total energy ratio

```{r}
totale_mean_gls_emmeans <- emmeans(totale_mean_gls, specs = ~ oera)

totale_estimates <- as.data.frame(totale_mean_gls_emmeans)
totale_estimates

```


### Table S6. Contrasts from GLS on total energy ratio

```{r}
totale_contrasts <- as.data.frame(pairs(totale_mean_gls_emmeans))
totale_contrasts

```

# Community composition

## Kangaroo rat proportional energy use


```{r, echo = F}

dipo_dat <- treatl %>%
  mutate(dipo_prop = dipo_e / total_e,
         smgran_prop= smgran_e / total_e) %>%
  group_by(oplottype) %>%
  mutate(smgran_prop_ma = maopts(smgran_prop),
         dipo_prop_ma = maopts(dipo_prop)) %>%
  ungroup() 

dipo_c_dat <- dipo_dat %>%
  filter(oplottype == "CC")

dipo_glm <- glm(dipo_prop ~ oera, family = quasibinomial(), data= dipo_c_dat)



```

### Table S7. Coefficients from GLM on Dipodomys energy use.

```{r}

dipo_coef <- as.data.frame(summary(dipo_glm)$coefficients)
dipo_coef

```


### Table S8. Estimates from GLM on Dipodomys energy use.

```{r}


dipoemmeans <- regrid(emmeans(dipo_glm, specs = ~ oera))

dipoestimates <- as.data.frame(dipoemmeans)

dipoestimates

```


### Table S9. Contrasts from GLM on Dipodomys energy use.

```{r}
dipocontrasts <- as.data.frame(pairs(dipoemmeans))
dipocontrasts

```


## C. baileyi proportional energy use


```{r, echo = F}

pb_glm_treat <- glm(pb_prop ~ oera * oplottype, family = quasibinomial(), data= pb_nozero)

```

### Table S10. Coefficients from GLM on C. baileyi energy use

```{r}

pb_coef <- as.data.frame(summary(pb_glm_treat)$coefficients)
pb_coef

```


### Table S11. Estimates from GLM on C. baileyi energy use

```{r}

pb_emmeans <- regrid(emmeans(pb_glm_treat, specs = ~ oera | oplottype))

pb_estimates <- as.data.frame(pb_emmeans)

pb_estimates

```

### Table S12. Contrasts from GLM on C. baileyi energy use.

```{r}
pb_contrasts <- as.data.frame(pairs(pb_emmeans))
pb_contrasts

```
